openapi: 3.0.0
info:
  title: URL Shortener API
  description: API documentation for the URL Shortener service.
  version: 1.0.0
servers:
  - url: /
    description: Main API server
paths:
  /api/health:
    get:
      tags:
        - System
      summary: Health check
      description: Check the status of the API and its services (database).
      responses:
        '200':
          description: System is healthy
        '503':
          description: System is unhealthy

  /api/auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password, password_confirmation]
              properties:
                name: { type: string }
                email: { type: string, format: email }
                password: { type: string, minLength: 8 }
                password_confirmation: { type: string }
      responses:
        '201':
          description: User created, verification email sent
        '422':
          description: Validation error

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        '200':
          description: Successful login
        '401':
          description: Invalid credentials

  /api/auth/validate-token:
    post:
      tags:
        - Authentication
      summary: Validate JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token]
              properties:
                token: { type: string }
      responses:
        '200':
          description: Token is valid
        '401':
          description: Token is invalid

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successfully logged out
        '401':
          description: Unauthorized - Bearer token missing or invalid

  /api/auth/user:
    get:
      tags:
        - Authentication
      summary: Get current authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user data
        '401':
          description: Unauthorized - Bearer token missing or invalid

  /api/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset link
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email: { type: string, format: email }
      responses:
        '200':
          description: Reset link sent (or email non-existent)

  /api/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password with token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, email, password, password_confirmation]
              properties:
                token: { type: string }
                email: { type: string, format: email }
                password: { type: string, minLength: 8 }
                password_confirmation: { type: string }
      responses:
        '200':
          description: Password reset successful
        '400':
          description: Invalid or expired token

  /api/profile:
    get:
      tags:
        - Profile
      summary: Get current user profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile data
        '401':
          description: Unauthorized - Bearer token missing or invalid
    put:
      tags:
        - Profile
      summary: Update profile
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                password: { type: string, minLength: 8 }
                password_confirmation: { type: string }
                previous_password: { type: string }
      responses:
        '200':
          description: Profile updated
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '422':
          description: Validation error or incorrect previous password
    delete:
      tags:
        - Profile
      summary: Delete your own account
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Account deleted
        '401':
          description: Unauthorized - Bearer token missing or invalid

  /api/short-links:
    get:
      tags:
        - Short Links
      summary: List user short links
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: Paginated list of links
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Email not verified
    post:
      tags:
        - Short Links
      summary: Create short link
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [original_url]
              properties:
                original_url: { type: string, format: url }
                expires_at: { type: string, format: date-time }
      responses:
        '201':
          description: Link created
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Email not verified
        '422':
          description: Validation error

  /api/short-links/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string }
    get:
      tags:
        - Short Links
      summary: Get short link details
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Link details
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Unauthorized or email not verified
        '404':
          description: Link not found
    put:
      tags:
        - Short Links
      summary: Update short link
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                original_url: { type: string, format: url }
                expires_at: { type: string, format: date-time }
      responses:
        '200':
          description: Link updated
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Unauthorized or email not verified
        '422':
          description: Validation error
    delete:
      tags:
        - Short Links
      summary: Delete short link
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Link deleted
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Unauthorized or email not verified

  /api/short-links/bulk-delete:
    post:
      tags:
        - Short Links
      summary: Bulk delete links
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ids]
              properties:
                ids: { type: array, items: { type: integer } }
      responses:
        '200':
          description: Links deleted
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Email not verified
        '422':
          description: Validation error

  /api/users:
    get:
      tags:
        - Admin
      summary: List all users
      security:
        - bearerAuth: []
      parameters:
        - name: role
          in: query
          schema: { type: string }
        - name: search
          in: query
          schema: { type: string }
      responses:
        '200':
          description: User list
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Admin access required
    post:
      tags:
        - Admin
      summary: Create a user
      security:
        - bearerAuth: []
      responses:
        '201':
          description: User created
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Admin access required

  /api/users/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string }
    get:
      tags:
        - Admin
      summary: Get user details
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User data
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Admin access required
    put:
      tags:
        - Admin
      summary: Update user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User updated
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Admin access required
    delete:
      tags:
        - Admin
      summary: Delete user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User deleted
        '401':
          description: Unauthorized - Bearer token missing or invalid
        '403':
          description: Forbidden - Admin access required

  /{code}:
    parameters:
      - name: code
        in: path
        required: true
        schema: { type: string }
    get:
      tags:
        - Public
      summary: Redirect to original URL
      responses:
        '302':
          description: Redirecting to original URL
        '404':
          description: Link not found
        '410':
          description: Link expired

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
