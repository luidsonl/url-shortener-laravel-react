openapi: 3.0.0
info:
  title: URL Shortener API
  description: API documentation for the URL Shortener service.
  version: 1.0.0
servers:
  - url: /api
    description: Main API server
paths:
  /health:
    get:
      tags:
        - System
      summary: Health check
      description: Check the status of the API and its services (database).
      responses:
        '200':
          description: System is healthy
        '503':
          description: System is unhealthy

  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password, password_confirmation]
              properties:
                name: { type: string }
                email: { type: string, format: email }
                password: { type: string, minLength: 8 }
                password_confirmation: { type: string }
      responses:
        '201':
          description: User created, verification email sent
        '422':
          description: Validation error

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        '200':
          description: Successful login
        '401':
          description: Invalid credentials

  /auth/validate-token:
    post:
      tags:
        - Authentication
      summary: Validate JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token]
              properties:
                token: { type: string }
      responses:
        '200':
          description: Token is valid
        '401':
          description: Token is invalid

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successfully logged out

  /auth/user:
    get:
      tags:
        - Authentication
      summary: Get current authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user data

  /forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset link
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email: { type: string, format: email }
      responses:
        '200':
          description: Reset link sent (or email non-existent)

  /reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password with token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, email, password, password_confirmation]
              properties:
                token: { type: string }
                email: { type: string, format: email }
                password: { type: string, minLength: 8 }
                password_confirmation: { type: string }
      responses:
        '200':
          description: Password reset successful
        '400':
          description: Invalid or expired token

  /profile:
    get:
      tags:
        - Profile
      summary: Get current user profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile data
    put:
      tags:
        - Profile
      summary: Update profile
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                password: { type: string, minLength: 8 }
                password_confirmation: { type: string }
                previous_password: { type: string }
      responses:
        '200':
          description: Profile updated
    delete:
      tags:
        - Profile
      summary: Delete your own account
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Account deleted

  /short-links:
    get:
      tags:
        - Short Links
      summary: List user short links
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: Paginated list of links
    post:
      tags:
        - Short Links
      summary: Create short link
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [original_url]
              properties:
                original_url: { type: string, format: url }
                expires_at: { type: string, format: date-time }
      responses:
        '201':
          description: Link created
        '422':
          description: Validation error

  /short-links/{code}:
    parameters:
      - name: code
        in: path
        required: true
        schema: { type: string }
    get:
      tags:
        - Short Links
      summary: Get short link details
      security:
        - bearerAuth: []
    put:
      tags:
        - Short Links
      summary: Update short link
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                original_url: { type: string, format: url }
                expires_at: { type: string, format: date-time }
    delete:
      tags:
        - Short Links
      summary: Delete short link
      security:
        - bearerAuth: []

  /short-links/bulk-delete:
    post:
      tags:
        - Short Links
      summary: Bulk delete links
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ids]
              properties:
                ids: { type: array, items: { type: integer } }

  /users:
    get:
      tags:
        - Admin
      summary: List all users
      security:
        - bearerAuth: []
      parameters:
        - name: role
          in: query
          schema: { type: string }
        - name: search
          in: query
          schema: { type: string }
    post:
      tags:
        - Admin
      summary: Create a user
      security:
        - bearerAuth: []

  /users/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string }
    get:
      tags:
        - Admin
      summary: Get user details
      security:
        - bearerAuth: []
    put:
      tags:
        - Admin
      summary: Update user
      security:
        - bearerAuth: []
    delete:
      tags:
        - Admin
      summary: Delete user
      security:
        - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
